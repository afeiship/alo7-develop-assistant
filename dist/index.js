/**
 *  name: @jswork/alo7-develop-assistant
 *  description: Develop assistant for alo7.
 *  homepage: https://github.com/afeiship
 *  version: 1.0.63
 *  date: 2021-07-21T10:57:42.311Z
 *  license: MIT
 */

!function(t){"function"==typeof define&&define.amd?define(t):t()}((function(){$(document).ready(()=>{if(!document.URL.includes("kellis-ng."))return!1;var t=nx.declare({methods:{start(){$("#contentContainer").find('[class^="Course__ContentLeftList"]').find('[data-component="react-card"]').each((t,n)=>{var e=$(n),i=e.data("uuid");e.find(".title").css({display:"flex"}),e.find(".title").addClass("gm-row gm-row-center gm-row-justify-between"),e.find(".title").append(`<button\n                  data-uuid="${i}"\n                  data-action="copy-course-uuid"\n                  class="gm-btn is-small gm-btn-default">🐠</button>`)}),$('[data-action="copy-course-uuid"]').click(t=>{var n=$(t.target).data("uuid");gmsdk.setClipboard(n),$.toast({icon:"success",heading:"复制成功",position:"top-right",stack:!1,hideAfter:1e3}),t.stopPropagation()})}}});nx.waitToDisplay("#contentContainer .alo7-pagination",1e3,n=>{(new t).start()})}),$(document).ready(()=>{if(!document.URL.includes("kellis-ng."))return!1;var t=nx.declare({methods:{start(){$(".ant-layout-header .ant-dropdown-trigger").after('<button id="copy-token" class="ant-btn ant-btn-primary">复制Token</button>'),this.attachEvents()},attachEvents(){$("#copy-token").click(()=>{var t=alo7Account.token;gmsdk.setClipboard(t),$.toast({icon:"success",heading:"复制成功",position:"top-right",stack:!1,hideAfter:1e3})})}}});setTimeout(()=>{(new t).start()},1e3)});var t=/redmine.*\/issues\/(\d+)/,n={Bug:"fix",Task:"feat"},e={Bug:"bug",Task:"issue"},i=GM_getResourceText("JQ_TOAST");GM_addStyle(i),gmsdk.addStyle('\n    #git_msg{\n      display: flex;\n      align-items: center;\n      justify-content:space-between;\n      background: #f9f9f9;\n      transition: all 0.3s;\n    }\n\n    #git_msg>.left{\n      flex: 1;\n    }\n\n    #git_msg>.right{\n      text-align: right;\n      color: #999;\n      font-size: 12px;\n    }\n\n    .git_action{\n      display: inline-block;\n      width: auto;\n      min-width: 1em;\n      margin-top: 3px;\n      padding: 1px 8px;\n      border-radius: 3px;\n      color: #fff;\n      font-size: .86em;\n      font-weight: bold;\n      text-align: center;\n      text-transform: uppercase;\n    }\n\n\n    .git_action[data-git-action="feat"]{\n      background-color: #584492;\n    }\n\n    .git_action[data-git-action="fix"]{\n      background-color: #e74c3c;\n    }\n'),$(document).ready((function(){if(t.exec(location.href)){var i=$("#content h2").eq(0).text(),[a,o]=i.split(" #"),s=$("#content h3").eq(0).text(),r=""+(n[a]||"feat"),c=`${s} - (REDMINE-${o})`,d=$(".fixed-version .value").text();$("#content h2").eq(0).after(`\n    <header id="git_msg" class="issue tracker-58 1-2 priority-4 priority-default details left">\n      <div class="left">\n        <span class="git_action" data-git-action="${r}">${r}</span>\n        :\n        <span class="git_msg">${c}</span>\n      </div>\n      <div class="right">\n        <button id="gitmsg" class="gm-btn gm-btn-primary is-large">复制: git message </button>\n        <button id="gitflow" class="gm-btn gm-btn-positive is-large">复制: gitflow branch name</button>\n      </div>\n    </header>\n  `),$("#gitmsg").click((function(){var t=`${r}: ${c}`,n=$(".fixed-version").text();if(n.includes(".")){var e=n.split(":")[1].toLowerCase();t=`${r}(${e}): ${c}`}gmsdk.setClipboard(t),$.toast({icon:"success",heading:"复制成功",position:"top-right",stack:!1,hideAfter:1e3,text:t})})),$("#gitflow").click((function(){var t=nx.kebabCase(d.replace(/[._()-]/g,"")),n=`${t?t+"/":""}redmine-${e[a]||"issue"}-${o}`;gmsdk.setClipboard(n),$.toast({icon:"info",heading:"复制成功",position:"top-right",stack:!1,hideAfter:1e3,text:n})}))}})),$(document).ready(()=>{if(!$(".page-metadata .author").text().includes("Tinny Tao"))return;var t=$('h1:contains("功能描述")');t.css({display:"flex","align-items":"center","justify-content":"space-between"}),t.append('<button id="rnotes-copy" class="aui-button aui-button-primary">Release Notes</button>');var n=t.next(".table-wrap").find(".relative-table tbody tr"),e=[],i=[];n.each((t,n)=>{var a=$(n).find("td:eq(1)").text();a&&e.push(`${t+1}. ${a}`),a&&i.push(a)});const a=e.map((t,n)=>{const e="rdm-issue-"+n;return`\n      <tr>\n        <td><input name="redmine-issue" data-index=${n} id="${e}" type="checkbox" /></td>\n        <td><label style="padding:5px; display:block;" for="${e}">${t}</label></td>\n      </tr>`});t.after(`\n    <form style="border:1px solid #ccc; margin: 10px auto;">\n\n      <table class="gm-table gm-table-striped">\n        <thead>\n          <tr>\n            <td align="center" width="20">\n              <div class="gm-row gm-row-center">\n                <input id="batch-checked" type="checkbox" />\n                <label id="batch-select" for="batch-checked">\n                  <strong>创建?</strong>\n                </label>\n              </div>\n            </td>\n            <td><strong>功能点</strong></td>\n          </tr>\n        </thead>\n        <tbody>\n          ${a.join("\n")}\n        </tbody>\n      </table>\n\n      <footer style="padding:10px;">\n        <button type="button" data-action="unselect-all" class="gm-btn gm-btn-primary">反选</button>\n        <button type="button" data-action="issues-create" class="gm-btn gm-btn-negative">一键复制JSON</button>\n      </footer>\n    </form>\n  `),$("#rnotes-copy").click(()=>{gmsdk.setClipboard(e.join("\n")),$.toast({icon:"success",heading:"复制成功",position:"top-right",stack:!1,hideAfter:1e3})}),$("#batch-select").click(t=>{t.stopPropagation();const n=$("#batch-select").prev("input").prop("checked");$('[name="redmine-issue"]').prop("checked",!n)}),$('[data-action="unselect-all"]').click(t=>{$('[name="redmine-issue"]').each((function(t,n){const e=$(n).prop("checked");$(n).prop("checked",!e)}))}),$('[data-action="issues-create"]').click(t=>{const n=$('[name="redmine-issue"]:checked'),e=nx.slice(n).map(t=>{const n=$(t).data("index");return{index:n,text:i[n]}});gmsdk.setClipboard(JSON.stringify(e)),$.toast({icon:"success",heading:"复制成功",position:"top-right",stack:!1,hideAfter:1e3})})}),$(document).ready(()=>{gmsdk.addStyle("\n    #resources .circle-index{\n      padding: 5px;\n      background: #547e03;\n      color: #fff;\n      border-radius: 50px;\n    }\n    #resources .resource .heading > h2{\n      font-size: 14px;\n    }\n    .operations li .heading .options li{\n      display: flex;\n      align-items: center;\n    }\n    .operations li .heading .options li a{\n      margin-left: 10px;\n      width: 120px;\n      overflow: hidden;\n      text-overflow: ellipsis;\n      display: block;\n    }\n  "),setTimeout(()=>{$("#resources .resource .heading > h2").each((t,n)=>{var e="0"+(t+1);$(n).prepend(`<i class="circle-index">${e.slice(-2)}</i>`),$(n).append('<button class="clipboard items">Copy</button>')}),$(".operations li .heading .options li").prepend('<button class="clipboard item">Copy</button>'),$(".clipboard.item").click(t=>{var n=$(t.target).parents(".heading").find(".path").text().trim(),e=$(t.target).parents(".heading").find(".http_method a").text().trim();gmsdk.setClipboard(`['${e.toLowerCase()}', '${n}']`)}),$(".clipboard.items").click(t=>{var n=$(t.target).parents(".heading").next(".endpoints").find(".operation > div.heading > h3 > span.path").text().split("\n").map(t=>t.trim()).filter(Boolean);gmsdk.setClipboard(JSON.stringify(n,null,2))})},1e3)})}));
